# テストケース一覧

新しい求人名抽出機能の動作確認用テストファイルです。

## 正常系テストケース

### `input 3.json` (元のファイル)
- **求人名**: `【ENG】バックエンドエンジニア（Go／クラウド基盤）【正社員】`
- **期待結果**: 正常に抽出され、HERPサイトとマッチング
- **信頼度**: 98% (役職情報を含む)

### `test_complex_1.json` - スペース過多パターン
- **求人名**: `【マネジャー】   インサイドセールス部署` (前後に多数のスペース)
- **期待結果**: スペースが正しくトリムされて抽出
- **信頼度**: 98%
- **テスト内容**: 前後の余分なスペースが適切に処理されるか

### `test_strict_2.json` - 装飾除去後一致
- **求人名**: `【正社員】★プロジェクトマネージャー★【IT・DX推進】`
- **期待結果**: 装飾文字除去後にプロジェクトマネージャーと一致
- **信頼度**: 90%
- **テスト内容**: 装飾文字（★【】など）が適切に除去されるか

## 🚨 **危険系テストケース（安全性確認）**

### `test_strict_1.json` - 危険な部分一致
- **求人名**: `【マネジャー候補】インサイドセールス部署`
- **期待結果**: 部分一致を検出するが安全性のため拒否
- **信頼度**: 85% → 0% (拒否)
- **テスト内容**: `インサイドセールス`との部分一致を検出するが、「マネジャー候補」が余分なため拒否

### `test_multiple_match.json` - 🚨 **複数マッチ（最重要）**
- **求人名**: `インサイドセールス`
- **期待結果**: 複数の求人（インサイドセールス、インサイドセールス２）にマッチして即座に拒否
- **信頼度**: 0% (複数マッチのため拒否)
- **テスト内容**: 複数求人へのマッチを検出して安全性のため処理停止

## エラー系テストケース

### `test_complex_2.json` - 微妙な不一致
- **求人名**: `【シニア】フロントエンドエンジニア（React/TypeScript専門）【正社員】`
- **期待結果**: HERPサイトに完全一致する求人がない場合の処理
- **テスト内容**: 部分一致や類似候補の検出

### `test_complex_3.json` - 求人名が短すぎる
- **求人名**: `IT` (2文字)
- **期待結果**: エラー「抽出された求人名が短すぎます」
- **信頼度**: 0%
- **テスト内容**: 最小文字数制限（3文字未満）

### `test_complex_4.json` - 求人名が長すぎる
- **求人名**: 非常に長い求人名（100文字超過）
- **期待結果**: エラー「抽出された求人名が長すぎます」
- **信頼度**: 0%
- **テスト内容**: 最大文字数制限（100文字超過）

### `test_complex_5.json` - パターン不一致
- **内容**: `推薦書類送付【マネジャー】インサイドセールス部署 現年収:600万円...`
- **期待結果**: エラー「ra_memo_rawから求人名パターンを抽出できませんでした」
- **テスト内容**: 「W送付」や「※」がない場合の処理

### `test_complex_8.json` - フィールド欠損
- **内容**: `ra_memo_raw`フィールドが存在しない
- **期待結果**: エラー「認識可能な求人名フィールドが見つかりませんでした」
- **テスト内容**: 必須フィールドが存在しない場合

## 特殊ケーステスト

### `test_complex_6.json` - 特殊文字・記号
- **求人名**: `【★急募★】AI/ML エンジニア（Python・TensorFlow・PyTorch）〈正社員〉～リモートワーク可～`
- **期待結果**: 特殊文字を含む求人名の正常処理
- **信頼度**: 98%
- **テスト内容**: 特殊文字や記号が含まれる場合の処理

### `test_complex_7.json` - 形式混在
- **従来形式**: `"name": "プロジェクトマネージャー"`
- **新形式**: `ra_memo_raw`にも求人名が存在
- **期待結果**: 従来形式が優先される（信頼度100%）
- **テスト内容**: 両方の形式が存在する場合の優先順位

## 🔒 **新しい安全性機能**

### **複数マッチ拒否システム**
- ✅ **同レベル複数マッチ**: 完全一致が2件以上 → 即座に拒否
- ✅ **異レベル複数マッチ**: 完全一致1件 + 正規化後一致1件 → 即座に拒否
- ✅ **詳細ログ**: どの求人がどのレベルでマッチしたかを記録
- ✅ **危険性警告**: 複数マッチの危険性をユーザーに明示

### **マッチングレベル（厳格順）**
1. **完全一致** (100%): 文字通り完全に同じ
2. **正規化後完全一致** (95%): スペース・記号統一後に完全一致
3. **装飾除去後完全一致** (90%): 【】★などの装飾文字除去後に完全一致
4. **厳格部分一致** (85% → 0%): 検出するが安全性のため拒否

## テスト実行方法

1. サーバーを起動: `npm start`
2. ブラウザで `http://localhost:3000` にアクセス
3. 各テストファイルをアップロードして実行
4. 期待結果と実際の結果を比較

## 🎯 **重要なテストシナリオ**

### **必須テスト**
1. **`test_multiple_match.json`**: 複数マッチ拒否の確認
2. **`test_strict_1.json`**: 危険な部分一致拒否の確認
3. **`input 3.json`**: 正常動作の確認

### **HERPサイトでの前提条件**
- `インサイドセールス` と `インサイドセールス２` の両方が存在
- `test_multiple_match.json` で `インサイドセールス` を検索すると両方にマッチ
- システムは複数マッチを検出して安全性のため処理停止

## 確認ポイント

### 正常系
- ✅ 求人名が正しく抽出される
- ✅ 信頼度が適切に計算される
- ✅ HERPサイトとのマッチングが動作する
- ✅ スペースや特殊文字が適切に処理される

### 🚨 **安全性（最重要）**
- ✅ **複数マッチは即座に拒否される**
- ✅ 部分一致は信頼度不足で拒否される
- ✅ 適切なエラーメッセージが表示される
- ✅ 処理が安全に停止する
- ✅ 詳細なエラー情報が提供される

### UI表示
- ✅ 抽出過程が可視化される
- ✅ 信頼度バーが正しく表示される
- ✅ エラー詳細が分かりやすく表示される
- ✅ **複数マッチの危険性警告が表示される**
- ✅ マッチした全求人の詳細が表示される

## 🛡️ **安全性チェック**

- 🔒 信頼度90%未満は処理停止
- 🔒 **複数候補がある場合は処理停止**
- 🔒 不正な形式は処理停止
- 🔒 全ての処理過程がログに記録される
- 🔒 **人の人生に関わるため最大限保守的に動作**

## ⚠️ **実際の運用での注意点**

- 企業名が求人名に含まれることが多く、複数マッチが発生しやすい
- `インサイドセールス` と `インサイドセールス２` のような類似求人が存在
- 複数マッチは**絶対に自動処理せず**、必ず手動確認を要求
- 間違った求人への応募を防ぐことが最優先 