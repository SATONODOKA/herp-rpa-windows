# 求人照合RPAツール（安全性強化版）

人の人生に関わる重要な求人マッチングを、**安全性を最優先**に行うRPAツールです。

## 🎯 **プロジェクトの目的**

- PDFから抽出された求人情報をHERPサイトの求人と自動照合
- **間違った求人への応募を防ぐ**ため、厳格な安全性チェックを実装
- 曖昧なマッチングは全て拒否し、確実に一致するもののみ処理

## 🏗️ **システム構成**

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   JSONファイル   │ -> │  求人名抽出処理  │ -> │ HERPサイト照合  │
│  (PDF由来データ) │    │  (安全性チェック) │    │ (厳格マッチング) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 📋 **対応する入力形式**

### **1. 従来形式（シンプル）**
```json
{
  "name": "インサイドセールス"
}
```

### **2. 新形式（複雑）**
```json
{
  "calib": {
    "record": {
      "ra_memo_raw": "W送付【マネジャー】インサイドセールス部署※現年収:600万円、希望年収:650万円"
    }
  }
}
```

## 🔍 **求人名抽出ロジック**

### **Step 1: 入力形式の判定**
1. `name`フィールドがある → **従来形式**（信頼度100%）
2. `calib.record.ra_memo_raw`がある → **新形式**を解析
3. どちらもない → **エラーで停止**

### **Step 2: 新形式の解析**
```javascript
// パターン: "W送付" + 求人名 + "※"
const pattern = /W送付\s*(.+?)\s*※/;
```

**例:**
- 入力: `"W送付【マネジャー】インサイドセールス部署※現年収:600万円"`
- 抽出: `"【マネジャー】インサイドセールス部署"`

### **Step 3: 安全性チェック**
- ✅ **3文字以上100文字以下** → 処理続行
- ❌ **3文字未満** → エラー「求人名が短すぎます」
- ❌ **100文字超過** → エラー「求人名が長すぎます」
- ❌ **パターン不一致** → エラー「抽出できませんでした」

## 🎯 **マッチングロジック（厳格4段階）**

### **Level 1: 完全一致（信頼度100%）**
```
JSON: "インサイドセールス"
HERP: "インサイドセールス"
→ ✅ 完全一致（処理続行）
```

### **Level 2: 正規化後完全一致（信頼度95%）**
```
JSON: "インサイド セールス"  (スペースあり)
HERP: "インサイドセールス"   (スペースなし)
→ 正規化: "インサイドセールス" = "インサイドセールス"
→ ✅ 正規化後一致（処理続行）
```

### **Level 3: 装飾除去後完全一致（信頼度90%）**
```
JSON: "【正社員】★プロジェクトマネージャー★"
HERP: "プロジェクトマネージャー"
→ 装飾除去: "プロジェクトマネージャー" = "プロジェクトマネージャー"
→ ✅ 装飾除去後一致（処理続行）
```

### **Level 4: 部分一致（信頼度85% → 0%拒否）**
```
JSON: "【マネジャー候補】インサイドセールス部署"
HERP: "インサイドセールス"
→ 部分一致を検出するが...
→ ❌ 信頼度85% < 90%（安全性のため拒否）
```

## 🚨 **安全性チェック（拒否条件）**

### **1. 信頼度不足**
```
信頼度90%未満 → 即座に拒否
理由: 人の人生に関わるため、不確実なマッチングは許可しない
```

### **2. 複数マッチ検出**
```
JSON: "インサイドセールス"
HERP: ["インサイドセールス", "インサイドセールス２"]
→ ❌ 複数の求人にマッチ（どちらが正しいか判断不可）
→ 即座に拒否
```

### **3. 異レベル複数マッチ**
```
完全一致: 1件 + 正規化後一致: 1件 = 計2件
→ ❌ 複数レベルでマッチ（混乱を避けるため拒否）
```

### **4. 部分一致（危険）**
```
JSON: "インサイドセールスマネジャー"
HERP: "インサイドセールス"
→ ❌ 部分一致（全く違う職種の可能性）
```

## ✅ **処理を通す条件**

### **絶対安全な条件のみ**
1. **単一の求人**にのみマッチ
2. **信頼度90%以上**
3. **完全一致系**（完全一致・正規化後一致・装飾除去後一致）
4. **抽出処理が正常**に完了

### **具体例**
```
✅ "プロジェクトマネージャー" → "プロジェクトマネージャー" (100%)
✅ "インサイド セールス" → "インサイドセールス" (95%)
✅ "【正社員】エンジニア" → "エンジニア" (90%)
```

## ❌ **処理を拒否する条件**

### **1. 抽出段階での拒否**
- 求人名が3文字未満
- 求人名が100文字超過
- 「W送付」「※」パターンが見つからない
- 必要なフィールドが存在しない

### **2. マッチング段階での拒否**
- 複数の求人にマッチ
- 信頼度90%未満
- 部分一致のみ
- どの求人ともマッチしない

### **具体例**
```
❌ "IT" → 短すぎる（2文字）
❌ "インサイドセールス" → ["インサイドセールス", "インサイドセールス２"] (複数マッチ)
❌ "マネジャー候補インサイドセールス" → "インサイドセールス" (部分一致)
❌ "フロントエンドエンジニア" → 該当なし (マッチしない)
```

## 🔧 **使用方法**

### **1. サーバー起動**
```bash
npm install
npm start
```

### **2. ブラウザアクセス**
```
http://localhost:3000
```

### **3. ファイルアップロード**
- JSONファイルをドラッグ&ドロップ
- または「ファイルを選択」ボタンから選択

### **4. 実行と結果確認**
- 「実行」ボタンをクリック
- 抽出過程と信頼度を確認
- マッチング結果を確認

## 📊 **UI表示内容**

### **抽出情報**
- 抽出方法（従来形式 or 新形式）
- 信頼度（95-100%）
- 元データの内容
- 警告メッセージ（あれば）

### **マッチング結果**
- マッチタイプ（完全一致・正規化後一致など）
- 信頼度バー（視覚的表示）
- マッチした求人名
- 拒否理由（拒否の場合）

### **詳細情報**
- 正規化後の文字列
- 装飾除去後の文字列
- 全求人のチェック結果
- 複数マッチの警告（該当時）

## 🧪 **テストケース**

### **正常系**
- `input 3.json`: 基本的な新形式テスト
- `test_complex_1.json`: スペース過多パターン
- `test_strict_2.json`: 装飾除去後一致

### **拒否系（安全性確認）**
- `test_strict_1.json`: 危険な部分一致
- `test_multiple_match.json`: 複数マッチ検出
- `test_complex_3.json`: 求人名が短すぎる
- `test_complex_4.json`: 求人名が長すぎる

### **エラー系**
- `test_complex_5.json`: パターン不一致
- `test_complex_8.json`: フィールド欠損

## 🛡️ **安全性の設計思想**

### **保守的アプローチ**
> 「間違いの可能性が1%でもあれば拒否する」

### **人の人生重視**
> 「間違った求人への応募は人生を左右する」

### **透明性の確保**
> 「全ての判断過程をログに記録し、検証可能にする」

### **フェイルセーフ**
> 「システムに問題があれば安全に停止する」

## ⚠️ **運用上の注意点**

### **複数マッチが発生しやすいケース**
- 企業名が求人名に含まれる場合
- 類似求人が複数存在する場合
- 求人名に数字や記号が含まれる場合

### **手動確認が必要なケース**
- 複数マッチが検出された場合
- 部分一致のみの場合
- 信頼度90%未満の場合

### **システムの限界**
- 完全に同じ文字列でないと高信頼度にならない
- 表記ゆれや略語には対応しない
- 人間の最終確認が必要

## 🔄 **今後の改善予定**

### **Phase 1: 現在**
- 完全一致系のみ処理
- 複数マッチは即座に拒否
- 部分一致は全て拒否

### **Phase 2: 検討中**
- 許可リスト方式の導入
- より精密な文字差分解析
- 管理者による安全パターンの登録

### **Phase 3: 将来**
- 機械学習による類似度判定
- 企業固有の表記ルール学習
- より高度な自然言語処理

## 📞 **サポート**

システムに関する質問や問題が発生した場合：
1. まず`TEST_CASES_README.md`でテストケースを確認
2. ログファイルで詳細な処理過程を確認
3. 不明な点があれば開発チームに相談

---

**重要**: このシステムは人の人生に関わる重要な判断を行います。安全性を最優先に設計されていますが、最終的な判断は必ず人間が行ってください。 